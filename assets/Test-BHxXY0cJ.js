import{D as $,H as A,F as T,a as S,L as W,b as H,S as Y,P as O,W as j,G as q,E as X,c as J,A as K,d as Q,e as Z,M as ee,O as re}from"./OrbitControls-C4_R_iy2.js";import{_ as ae,c as U,g as I,m as te,t as ne,p as oe,b as N}from"./index-DxHNI6Aq.js";class se extends ${constructor(c){super(c),this.type=A}parse(c){const d=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},G=`
`,v=function(e,t,l){t=t||1024;let s=e.pos,n=-1,r=0,i="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));for(;0>(n=a.indexOf(G))&&r<t&&s<e.byteLength;)i+=a,r+=a.length,s+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(s,s+128)));return-1<n?(e.pos+=r+n+1,i+a.slice(0,n)):!1},x=function(e){const t=/^#\?(\S+)/,l=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,n=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,r={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let i,a;if(e.pos>=e.byteLength||!(i=v(e)))return d(1,"no header found");if(!(a=i.match(t)))return d(3,"bad initial token");for(r.valid|=1,r.programtype=a[1],r.string+=i+`
`;i=v(e),i!==!1;){if(r.string+=i+`
`,i.charAt(0)==="#"){r.comments+=i+`
`;continue}if((a=i.match(l))&&(r.gamma=parseFloat(a[1])),(a=i.match(o))&&(r.exposure=parseFloat(a[1])),(a=i.match(s))&&(r.valid|=2,r.format=a[1]),(a=i.match(n))&&(r.valid|=4,r.height=parseInt(a[1],10),r.width=parseInt(a[2],10)),r.valid&2&&r.valid&4)break}return r.valid&2?r.valid&4?r:d(3,"missing image size specifier"):d(3,"missing format specifier")},V=function(e,t,l){const o=t;if(o<8||o>32767||e[0]!==2||e[1]!==2||e[2]&128)return new Uint8Array(e);if(o!==(e[2]<<8|e[3]))return d(3,"wrong scanline width");const s=new Uint8Array(4*t*l);if(!s.length)return d(4,"unable to allocate buffer space");let n=0,r=0;const i=4*o,a=new Uint8Array(4),y=new Uint8Array(i);let D=l;for(;D>0&&r<e.byteLength;){if(r+4>e.byteLength)return d(1);if(a[0]=e[r++],a[1]=e[r++],a[2]=e[r++],a[3]=e[r++],a[0]!=2||a[1]!=2||(a[2]<<8|a[3])!=o)return d(3,"bad rgbe scanline format");let L=0,E;for(;L<i&&r<e.byteLength;){E=e[r++];const R=E>128;if(R&&(E-=128),E===0||L+E>i)return d(3,"bad scanline data");if(R){const w=e[r++];for(let k=0;k<E;k++)y[L++]=w}else y.set(e.subarray(r,r+E),L),L+=E,r+=E}const z=o;for(let R=0;R<z;R++){let w=0;s[n]=y[R+w],w+=o,s[n+1]=y[R+w],w+=o,s[n+2]=y[R+w],w+=o,s[n+3]=y[R+w],n+=4}D--}return s},P=function(e,t,l,o){const s=e[t+3],n=Math.pow(2,s-128)/255;l[o+0]=e[t+0]*n,l[o+1]=e[t+1]*n,l[o+2]=e[t+2]*n,l[o+3]=1},C=function(e,t,l,o){const s=e[t+3],n=Math.pow(2,s-128)/255;l[o+0]=S.toHalfFloat(Math.min(e[t+0]*n,65504)),l[o+1]=S.toHalfFloat(Math.min(e[t+1]*n,65504)),l[o+2]=S.toHalfFloat(Math.min(e[t+2]*n,65504)),l[o+3]=S.toHalfFloat(1)},F=new Uint8Array(c);F.pos=0;const b=x(F);if(b!==-1){const e=b.width,t=b.height,l=V(F.subarray(F.pos),e,t);if(l!==-1){let o,s,n;switch(this.type){case T:n=l.length/4;const r=new Float32Array(n*4);for(let a=0;a<n;a++)P(l,a*4,r,a*4);o=r,s=T;break;case A:n=l.length/4;const i=new Uint16Array(n*4);for(let a=0;a<n;a++)C(l,a*4,i,a*4);o=i,s=A;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:e,height:t,data:o,header:b.string,gamma:b.gamma,exposure:b.exposure,type:s}}}return null}setDataType(c){return this.type=c,this}load(c,h,f,m){function B(p,d){switch(p.type){case T:case A:p.encoding=W,p.minFilter=H,p.magFilter=H,p.generateMipmaps=!1,p.flipY=!0;break}h&&h(p,d)}return super.load(c,B,f,m)}}const ie={data(){return{progress:"0%",loadSuccess:!1}},mounted(){const g=new Y,c=new O(75,window.innerWidth/window.innerHeight,.1,1e3);c.position.set(0,1,5);const h=new j;h.setSize(window.innerWidth,window.innerHeight),this.$refs.draw.appendChild(h.domElement);const f=new q(1e3,50,4473924,4473924);g.add(f),new se().load("studio_small_08_1k.hdr",_=>{_.mapping=X,g.environment=_,console.log("HDR 加载成功")});const m=new J(16777215,1);m.position.set(5,5,5),g.add(m);const B=new K(4210752,2);g.add(B);const p=new Q(16777215,2,10);p.position.set(-10,5,10),g.add(p),new Z().load("model_building.glb",_=>{_.scene.traverse(G=>{G.isMesh&&(G.material=new ee({color:12320767,emissiveIntensity:1.5,metalness:.5,roughness:.3,transparent:!0,opacity:.7}))}),g.add(_.scene),console.log("模型加载成功",_),this.loadSuccess=!0},_=>{this.progress=`${(_.loaded/_.total*100).toFixed(0)}%`},_=>{console.error("模型加载失败",_)});const u=new re(c,h.domElement);u.enableDamping=!0,u.dampingFactor=.25,u.screenSpacePanning=!1,u.maxPolarAngle=Math.PI/2;function M(){requestAnimationFrame(M),u.update(),h.render(g,c)}M()}},le={style:{width:"100%",height:"100%",position:"relative"}},ce={id:"three_div",ref:"draw",class:"draw"},de={key:0,class:"loadingBox"},_e={class:"progress"},pe={class:"progress-value"};function ge(g,c,h,f,m,B){return N(),U("div",le,[I("div",ce,null,512),m.loadSuccess?(N(),U("div",de,[I("div",_e,[I("div",{class:"progress-bar progress-bar-danger progress-bar-striped active",style:te({width:m.progress})},[I("div",pe,ne(m.progress),1)],4)])])):oe("",!0)])}const Ee=ae(ie,[["render",ge]]);export{Ee as default};
